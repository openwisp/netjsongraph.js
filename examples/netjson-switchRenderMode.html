<!DOCTYPE html>
<html lang="en">
  <head>
    <title>netjsongraph.js: basic example</title>
    <meta charset="utf-8" />
    <!-- theme can be easily customized via css -->
    <link href="../src/css/netjsongraph-theme.css" rel="stylesheet" />
    <link href="../src/css/netjsongraph.css" rel="stylesheet" />
  </head>
  <body>
    <script type="text/javascript" src="../dist/netjsongraph.min.js"></script>
    <script type="text/javascript">
      /*
            The demo is used to show how to switch the netjsongraph render mode -- `svg` or `canvas`.
        */
      const graph = new NetJSONGraph("./data/netjsonmap.json", {
        onLoad: function () {
          switchRenderMode(this);
          const gui = this.utils.getGUI(this);
          gui.init();
          if (this.config.metadata) {
            gui.createAboutContainer(graph);
            this.utils.updateMetadata.call(this);
          }
          if (this.config.switchMode) {
            gui.renderModeSelector.onclick = () => {
              if (this.config.render === this.utils.mapRender) {
                this.config.render = this.utils.graphRender;
                const canvasContainer = this.echarts
                  .getZr()
                  .painter.getViewportRoot().parentNode;
                this.echarts.clear();
                this.utils.graphRender(this.data, this);
                canvasContainer.style.background =
                  // eslint-disable-next-line no-underscore-dangle
                  this.echarts.getZr()._backgroundColor;
              } else {
                this.echarts.clear();
                this.config.render = this.utils.mapRender;
                this.utils.mapRender(this.data, this);
              }
            };
          }
          this.config.onClickElement = (type, data) => {
            let nodeLinkData;
            if (type === "node") {
              nodeLinkData = this.utils.nodeInfo(data);
            } else {
              nodeLinkData = this.utils.linkInfo(data);
            }
            gui.getNodeLinkInfo(type, nodeLinkData);
            gui.sideBar.classList.remove("hidden");
          };
          this.utils.hideLoading();
        },
      });

      graph.render();

      /**
       * @function
       * @name switchRenderMode
       * Switch rendering mode -- Canvas or Svg. Poor performance, not recommended.
       *
       * @param {object} _this  NetJSONGraph object
       *
       * @return {object} switchWrapper DOM
       */

      function switchRenderMode(_this) {
        const switchWrapper = document.createElement("div"),
          checkInput = document.createElement("input"),
          checkLabel = document.createElement("label"),
          canvasMode = document.createElement("b"),
          svgMode = document.createElement("b");

        switchWrapper.setAttribute("class", "switch-wrap");
        checkInput.setAttribute("id", "switch");
        checkInput.setAttribute("type", "checkbox");
        checkLabel.setAttribute("for", "switch");
        canvasMode.innerHTML = "Canvas";
        svgMode.innerHTML = "Svg";
        checkInput.onchange = () => {
          // Switch between different rendering modes -- `canvas` or `svg`.
          // Poor performance, not recommended.
          _this.config.svgRender = !_this.config.svgRender;

          // reDraw
          _this.echarts.dispose();
          const graph = new NetJSONGraph(_this.data, {
            ..._this.config,
            el: _this.el,
          });
          graph.render();
        };
        if (_this.config.svgRender) {
          checkInput.checked = true;
        } else {
          checkInput.checked = false;
        }
        switchWrapper.appendChild(canvasMode);
        switchWrapper.appendChild(checkInput);
        switchWrapper.appendChild(checkLabel);
        switchWrapper.appendChild(svgMode);
        _this.el.appendChild(switchWrapper);

        return switchWrapper;
      }
    </script>
  </body>
</html>
